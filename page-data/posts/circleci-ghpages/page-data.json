{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/circleci-ghpages/","webpackCompilationHash":"9fd91b5d07ec54c91480","result":{"data":{"markdownRemark":{"id":"9ac7a1bc-1ca0-581e-a862-cd99353f0115","html":"<p><a href=\"https://www.gatsbyjs.org/starters/alxshelepenok/gatsby-starter-lumen/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gatsby-starter-lumen</a> \b템플릿에서 시작해서 CircleCI까지 붙이는 것은 <a href=\"https://kujyp.github.io/posts/2019-02-24---gatsby-%EC%A0%95%EC%A0%81%EB%B8%94%EB%A1%9C%EA%B7%B8-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0---%EC%9E%90%EB%8F%99deploy,-CircleCI%EC%97%B0%EB%8F%99/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gatsby 정적블로그 생성하기 - 자동deploy, CircleCI연동</a> 등 자료를 참고해서 만들 수 있다.</p>\n<p>다만, <a href=\"https://github.com/tschaub/gh-pages\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gh-pages</a>의 기본 브랜치인 <code>gh-pages</code> 혹은 위의 튜토리얼을 따라했다면 <code>master</code> 브랜치에 프로덕션으로 나갈 파일들이 푸시되기 때문에 CircleCI에 의해 빌드가 일어나게 된다.</p>\n<p>하지만 <code>gatsby build</code> 명령이 포함된 <code>yarn build</code> 명령이 수행되는 곳은 개발 브랜치기 때문에 CircleCI는 다른 브랜치에서 돌 필요가 없다. 게다가 <code>gh-pages</code>의 옵션으로 지정된 브랜치에는 <code>.circleci/config.yml</code> 파일이 존재하지 않기 때문에 결과는 항상 아래처럼 fail이 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 550px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9e33c9e6e8ab067f339b69ff0f65479/2cf63/190904-circleci-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACS0lEQVQ4y5WTy0tbQRTG73/ozoWu3IggqIigoKkgIr6g4kYpUqHQTQm0LoqPhULjpja0FFLFNKkN1TzvzX1lZq5J7v16zphIkpbUHjhMMpmcOef7fWNI00RweAh3eRn25CTc+Xk4MzMwBwdhDQ+jMjAAGY8jBHCZSiGTyaBfGNLzEFxcwN/fh7e9DX9vD97ODty1NbgbG3BWVhAkk4josKgJ1Ch7I4qixzTU/X17F/+KxNF7/Ly+guv5KBQKKJVK8H2/p0Mh9O39stlo6MNHb+P4fvUNQkpYlgXbtqnjmu4sDEOdhlAKynEgbm8h83m9ClpluQxJHchKBTyFCtTDIJT1eh0NuoSTPyuqEQSBTkPSTerkBO76Ouy5OQ3HicVgjozAGh2FOTQEeXCAJhXKptNIp691Ye6mrVv3yK6L4Pwc3u4u3NVVDcbd3IS9sABncRH27CyCREJTljSq79eeAIW/0Bo1m4hohKilWS+o5Icz3N1kUSPdTZKCdRRC/B+UsAPKu9evcPn1CzwiWywWUSadPbLdn1DoAENQ1SrY6Ip1JSl0sk+pIAvejkYPlDaQByhUJDg7g7e1pTVjOAzGGh9HdWpKg1HHxxrKzY8scrncI5Q2mO6RyUvq9JQKPofzLKZfiLO0hOrEBKrT07DGxrQLeHQ2sW07f4XSXjUUhhGyltRySCQjkoHB6OQuWn9MffqI8t0vSPqdTe2Qf5l8J2lDtTb6BRflePPyBVKfk/rp5cn8DIahdI3MG09NIaS2jBA1bRdOfnqdZ34DViBeUFIuDacAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/f9e33c9e6e8ab067f339b69ff0f65479/01472/190904-circleci-1.webp 240w,\n/static/f9e33c9e6e8ab067f339b69ff0f65479/222bd/190904-circleci-1.webp 480w,\n/static/f9e33c9e6e8ab067f339b69ff0f65479/92b74/190904-circleci-1.webp 550w\"\n          sizes=\"(max-width: 550px) 100vw, 550px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f9e33c9e6e8ab067f339b69ff0f65479/0783d/190904-circleci-1.png 240w,\n/static/f9e33c9e6e8ab067f339b69ff0f65479/782f4/190904-circleci-1.png 480w,\n/static/f9e33c9e6e8ab067f339b69ff0f65479/2cf63/190904-circleci-1.png 550w\"\n          sizes=\"(max-width: 550px) 100vw, 550px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/f9e33c9e6e8ab067f339b69ff0f65479/2cf63/190904-circleci-1.png\"\n          alt=\"CircleCI Fail\"\n          title=\"CircleCI Fail\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>실제 github page 배포에는 영향이 없지만 Fail은 기분이 나쁘니 없애보자.</p>\n<p><a href=\"https://circleci.com/docs/2.0/skip-build/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CircleCI 문서</a>를 보면, 커밋 메세지에 <code>[ci skip]</code>을 추가하면 해당 커밋 뿐만 아니라 푸시할 때 포함된 다른 커밋까지도 CircleCI가 skip한다고 한다.</p>\n<p>편리하게도 <code>gh-pages</code> 에서 커밋 메세지를 커스텀할 수 있는 옵션을 준다. 따라서 <code>package.json</code> 파일 내 deploy script를 아래와 같이 변경하자.</p>\n<pre class=\"default-dark vscode-highlight\" data-language=\"diff\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk8\">- yarn run clean &amp;&amp; gatsby build --prefix-paths &amp;&amp; gh-pages -d public -b master -r &lt;repo 주소&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk7\">+ yarn run clean &amp;&amp; gatsby build --prefix-paths &amp;&amp; gh-pages -d public -b master -r &lt;repo 주소&gt; -m &#39;[ci skip]&#39;</span></span></code></pre>\n<p>해결되었다!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 930px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb8c003706e33810321a80d376476955/17aeb/190904-circleci-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.11827956989247%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABRUlEQVQoz42RS07DMBCGczYugrgA92DRE4AqVYJFD8AVYJFFkShCQiTKm5CEvJo48SP58VgKbXdY+vWPx4nH34yV5zk8z0MYhsYdx0Fd1xiGAW3bous6MMZwOBxMTKK47/uzPO2FELBs28Zms8F2u8V6vcZqtcJ+v8c4jgiCAEmSoGkaxHGMKIpMYd/3QQ8py9J8Q2e0n+cZ1qQUFJeQXEAJaUTLeX9DHPiQ+ryqKlPgP8vq+YCG92g5M16PHbiSyNMUdVVi5NwgUQsIicR1bnESFVvOrIfwCZe7W1y/3uNqd4eL5xs8pi/AqBDEkcGhni7IhOi6LrIsQ6qLUo5caZJpmmD9iA4Oy+CxAi7L8dGlGKAQOZ+IfA+lxqXhUL+KojCvoR9PdYY8CQWoGZDT0bV5+sLvr8RMb5kiXUyIUso/xNOY9AvpTA/QPVvZSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/bb8c003706e33810321a80d376476955/01472/190904-circleci-2.webp 240w,\n/static/bb8c003706e33810321a80d376476955/222bd/190904-circleci-2.webp 480w,\n/static/bb8c003706e33810321a80d376476955/0e9bf/190904-circleci-2.webp 930w\"\n          sizes=\"(max-width: 930px) 100vw, 930px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/bb8c003706e33810321a80d376476955/0783d/190904-circleci-2.png 240w,\n/static/bb8c003706e33810321a80d376476955/782f4/190904-circleci-2.png 480w,\n/static/bb8c003706e33810321a80d376476955/17aeb/190904-circleci-2.png 930w\"\n          sizes=\"(max-width: 930px) 100vw, 930px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/bb8c003706e33810321a80d376476955/17aeb/190904-circleci-2.png\"\n          alt=\"resolution\"\n          title=\"resolution\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<style class=\"vscode-highlight-styles\">:root {\n  --vscode-highlight-padding-v: 1rem;\n  --vscode-highlight-padding-h: 1.5rem;\n  --vscode-highlight-padding-top: var(--vscode-highlight-padding-v);\n  --vscode-highlight-padding-right: var(--vscode-highlight-padding-h);\n  --vscode-highlight-padding-bottom: var(--vscode-highlight-padding-v);\n  --vscode-highlight-padding-left: var(--vscode-highlight-padding-h);\n  --vscode-highlight-border-radius: 8px;\n\n  --vscode-highlight-line-highlighted-background-color: transparent;\n  --vscode-highlight-line-highlighted-border-width: 4px;\n  --vscode-highlight-line-highlighted-border-color: transparent;\n}\n\n.vscode-highlight {\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  padding-top: 1rem;\n  padding-top: var(--vscode-highlight-padding-top);\n  padding-bottom: 1rem;\n  padding-bottom: var(--vscode-highlight-padding-bottom);\n  border-radius: 8px;\n  border-radius: var(--vscode-highlight-border-radius);\n  font-feature-settings: normal;\n}\n\n.vscode-highlight-code {\n  display: inline-block;\n  min-width: 100%;\n}\n\n.vscode-highlight-line {\n  display: inline-block;\n  box-sizing: border-box;\n  width: 100%;\n  padding-left: 1.5rem;\n  padding-left: var(--vscode-highlight-padding-left);\n  padding-right: 1.5rem;\n  padding-right: var(--vscode-highlight-padding-right);\n}\n\n.vscode-highlight-line-highlighted {\n  background-color: var(--vscode-highlight-line-highlighted-background-color);\n  box-shadow: inset var(--vscode-highlight-line-highlighted-border-width) 0 0 0 var(--vscode-highlight-line-highlighted-border-color);\n}\n.default-dark {\nbackground-color: #1E1E1E;\ncolor: #D4D4D4;\n}\n\n.default-dark .mtk1 { color: #D4D4D4; }\n.default-dark .mtk2 { color: #1E1E1E; }\n.default-dark .mtk3 { color: #6A9955; }\n.default-dark .mtk4 { color: #569CD6; }\n.default-dark .mtk5 { color: #D16969; }\n.default-dark .mtk6 { color: #D7BA7D; }\n.default-dark .mtk7 { color: #B5CEA8; }\n.default-dark .mtk8 { color: #CE9178; }\n.default-dark .mtk9 { color: #646695; }\n.default-dark .mtk10 { color: #4EC9B0; }\n.default-dark .mtk11 { color: #DCDCAA; }\n.default-dark .mtk12 { color: #9CDCFE; }\n.default-dark .mtk13 { color: #000080; }\n.default-dark .mtk14 { color: #F44747; }\n.default-dark .mtk15 { color: #C586C0; }\n.default-dark .mtk16 { color: #6796E6; }\n.default-dark .mtk17 { color: #808080; }\n.default-dark .mtki { font-style: italic; }\n.default-dark .mtkb { font-weight: bold; }\n.default-dark .mtku { text-decoration: underline; text-underline-position: under; }</style>","fields":{"slug":"/posts/circleci-ghpages/","tagSlugs":["/tag/ci-cd/","/tag/circle-ci/"]},"frontmatter":{"date":"2019-09-04","description":"gh-pages의 기본 브랜치에서 CircleCI 빌드를 skip하자.","tags":["CI/CD","CircleCI"],"title":"CircleCI Github page 브랜치 빌드 skip하기","socialImage":"/media/190904-circleci-1.png"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/circleci-ghpages/"}}}